!function(a,b,c,d){"use strict";function e(a){for(var b,c=0,d=x.length;d>c;c++)if(b=x[c],b.element===a)return b.editor}function f(a,b){var d=this,e=g.bind(d);c.call(d,{wildcard:!0}),d.state={active:!1},d.content=a,d.options=b||{},d.on("report.*",v.bind(d)),e("htmlWrap",!0),h.call(d),i.call(d),m.call(d),x.push({editor:d,element:a})}function g(a,b){a in this.options||(this.options[a]=b)}function h(){var a=this,b=a.content;b.contentEditable=!0,b.classList.add("py-editable")}function i(){var a=this,c=b.createElement("textarea");c.className="py-pastebin",a.pastebin=c,b.body.appendChild(c),b[A]("paste",j.bind(a)),b[A]("keydown",k.bind(a)),b[A]("keypress",function(a){(a.metaKey&&!a.ctrlKey||a.ctrlKey&&!a.metaKey)&&118===a.keyCode&&j(a)})}function j(a){var b=this;p(b.content,a.target)&&(b.saveSelection(),pastebin.focus(),setTimeout(function(){b.restoreSelection(!0),l(pastebin.value),pastebin.value=""}))}function k(a){var b=this;p(b.content,a.target)&&9===a.keyCode&&(a.preventDefault(),z("insertHTML",!1,"    "))}function l(c){var d,e,f=a.getSelection();f.getRangeAt&&f.rangeCount&&(d=f.getRangeAt(0),d.deleteContents(),e=b.createTextNode(c),d.insertNode(e),f.removeAllRanges(),d=d.cloneRange(),d.selectNode(e),d.collapse(!1),f.addRange(d))}function m(){var a=this;b[A]("keyup",function(b){n.call(a,b)}),b[A]("mousedown",function(b){n.call(a,b)}),b[A]("mouseup",function(b){setTimeout(function(){n.call(a,b)},0)})}function n(b){var c=this;if(!p(c.popover,b.target)&&!p(c.pickerContainer,b.target)){var d=a.getSelection();c.saveSelection(),d.isCollapsed===!1&&(c.currentNodeList=o(c.content,d.focusNode),q(c.currentNodeList,"PONYEDIT")&&c.report()),w=d.isCollapsed,c.emit("report.active",!w,"active")}}function o(a,b){for(var c={};b.parentNode;)b===a?c.PONYEDIT=!0:c[b.nodeName]=!0,b=b.parentNode;return c}function p(a,b){for(;b.parentNode;){if(b===a)return!0;if(b.parentNode===a)return!0;b=b.parentNode}}function q(a,b){return!!a[b]}function r(){var a=d.getSelection(),b=a.toHtml(),c=b.match(B);return c&&c.length>1?(console.log("match-si",c),c[1]):(console.log("match-no",y("fontSize")),y("fontSize"))}function s(c){var e,f=d.getSelection(),g=f.getRangeAt(0),h=g.commonAncestorContainer.children;console.log(g);var i=h&&h[0].classList.contains("py-pixels-element");i?(console.log("px"),container.style.fontSize=c+"px"):(console.log("px-no"),e=b.createElement("span"),e.classList.add("py-pixels-element"),e.style.fontSize=c+"px",g.surroundContents(e),g.selectNode(e),f.setSingleRange(g),a.c=g)}function t(a,b){return function(c,d){var e=this;e.restoreSelection(!d),e["exec"+a].apply(e,c||[]),e["report"+(b||a)]()}}function u(a,b,c){var d=/^['"]|['"]$/g,e=C[a]||y;return function(){var f=this,g=e.call(f,a),h="report."+b;return"bool"===c?g="true"===g||g===!0:"int"===c?g=parseInt(g,10):"fontName"===a&&(g=g.replace(d,"")),f.emit(h,g,b),g}}function v(a,b){var c,d=this;if("active"===b&&a===!1)for(c in d.state)delete d.state[b];d.state[b]=a}var w,x=[],y=b.queryCommandValue.bind(b),z=b.execCommand.bind(b),A="addEventListener";f.prototype=Object.create(c.prototype),f.prototype.constructor=f,f.prototype.focus=function(){var c=b.createRange(),d=a.getSelection();c.setStart(this.content,0),d.removeAllRanges(),d.addRange(c)},f.prototype.html=function(a){function b(a){return c.options.htmlWrap===!1?a:("<div>"!==a.substr(0,5)&&(a="<div>"+a+"</div>"),a)}var c=this;return void 0===a?b(c.content.innerHTML):(c.content.innerHTML=b(a),void 0)},f.prototype.getSelection=function(){var b,c=this,d=a.getSelection();return d.getRangeAt&&d.rangeCount&&(b=d.getRangeAt(0),p(c.content,b.commonAncestorContainer))?b:void 0},f.prototype.saveSelection=function(){var a=this,b=a.getSelection();void 0!==b&&(a.lastRange=b)},f.prototype.restoreSelection=function(b){var c,d=this,e=d.lastRange;e&&(c=a.getSelection(),c.removeAllRanges(),c.addRange(e),b===!0&&(d.lastRange=null))};var B=/^<span\s+class=["']py-pixels-element["']\s+style=["'].*font-size\s*:\s*([0-9]+)px\s*;?.*["']/i;f.prototype.execBold=function(){z("bold",!1)},f.prototype.execItalic=function(){z("italic",!1)},f.prototype.execSize=function(a){this.options.pixels?s(a):z("fontSize",!1,a)},f.prototype.execSizeDecrease=function(){var a=C.fontSize.call(this)-1;this.options.pixels?s(a):z("fontSize",!1,a)},f.prototype.execSizeIncrease=function(){var a=C.fontSize.call(this)+1;this.options.pixels?s(a):z("fontSize",!1,a)},f.prototype.execType=function(a){z("fontName",!1,a)},f.prototype.execColor=function(a){z("foreColor",!1,a)},f.prototype.execAlignment=function(a){var b=a[0].toUpperCase()+a.slice(1).toLowerCase();z("justify"+b,!1,null)},f.prototype.setBold=t("Bold"),f.prototype.setItalic=t("Italic"),f.prototype.setSize=t("Size"),f.prototype.decreaseSize=t("SizeDecrease","Size"),f.prototype.increaseSize=t("SizeIncrease","Size"),f.prototype.setType=t("Type"),f.prototype.setColor=t("Color"),f.prototype.setAlignment=t("Alignment");var C={fontSize:function(){var a=this.options.pixels?r():y("fontSize");return parseInt(a,10)},alignment:function(){var a=y("justifyLeft"),b=y("justifyCenter"),c=y("justifyRight");return"true"===a||a===!0?"left":"true"===b||b===!0?"center":"true"===c||c===!0?"right":""}};f.prototype.reportBold=u("bold","bold","bool"),f.prototype.reportItalic=u("italic","italic","bool"),f.prototype.reportSize=u("fontSize","size","int"),f.prototype.reportType=u("fontName","type"),f.prototype.reportColor=u("foreColor","color"),f.prototype.reportAlignment=u("alignment","alignment"),f.prototype.report=function(){var a=this;a.reportBold(),a.reportItalic(),a.reportSize(),a.reportType(),a.reportColor(),a.reportAlignment()},f.prototype.meta={fontSizes:[1,2,3,4,5,6,7],fontTypes:["Arial","Arial Black","Comic Sans MS","Courier","Courier New","Georgia","Helvetica","Impact","Palatino","Times New Roman","Trebuchet MS","Verdana"],alignments:["Left","Center","Right"]},Object.freeze(f.prototype.meta),a.ponyedit=function(a){return a instanceof f?a:e(a)},a.ponyedit.meta=f.prototype.meta,a.ponyedit.init=function(a,b){var c=e(a);return c?c:new f(a,b)}}(window,document,EventEmitter2,rangy);