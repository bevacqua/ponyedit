!function(a,b,c){"use strict";function d(a){for(var b,c=0,d=A.length;d>c;c++)if(b=A[c],b.element===a)return b.editor}function e(a,b){var d=this,e=f.bind(d);c.call(d,{wildcard:!0}),d.state={active:!1},d.content=a,d.options=b||{},d.on("report.*",y.bind(d)),e("htmlWrap",!0),g.call(d),h.call(d),l.call(d),A.push({editor:d,element:a})}function f(a,b){a in this.options||(this.options[a]=b)}function g(){var a=this,b=a.content;b.contentEditable=!0,b.classList.add("py-editable")}function h(){var a=this,c=b.createElement("textarea");c.className="py-pastebin",a.pastebin=c,b.body.appendChild(c),b[D]("paste",i.bind(a)),b[D]("keydown",j.bind(a)),b[D]("keypress",function(a){(a.metaKey&&!a.ctrlKey||a.ctrlKey&&!a.metaKey)&&118===a.keyCode&&i(a)})}function i(a){var b=this;o(b.content,a.target)&&(b.saveSelection(),b.pastebin.focus(),setTimeout(function(){b.restoreSelection(!0),k(b.pastebin.value),b.pastebin.value=""}))}function j(a){var b=this;o(b.content,a.target)&&9===a.keyCode&&(a.preventDefault(),C("insertHTML",!1,"    "))}function k(c){var d,e,f=a.getSelection();f.getRangeAt&&f.rangeCount&&(d=f.getRangeAt(0),d.deleteContents(),e=b.createTextNode(c),d.insertNode(e),f.removeAllRanges(),d=d.cloneRange(),d.selectNode(e),d.collapse(!1),f.addRange(d))}function l(){var a=this;b[D]("keyup",function(b){m.call(a,b)}),b[D]("mousedown",function(b){m.call(a,b)}),b[D]("mouseup",function(b){setTimeout(function(){m.call(a,b)},0)})}function m(b){var c=this;if(!o(c.popover,b.target)&&!o(c.pickerContainer,b.target)){var d=a.getSelection();c.saveSelection(),d.isCollapsed===!1&&(c.currentNodeList=n(c.content,d.focusNode),p(c.currentNodeList,"PONYEDIT")&&c.report()),z=d.isCollapsed,c.emit("report.active",!z,"active")}}function n(a,b){for(var c={};b.parentNode;)b===a?c.PONYEDIT=!0:c[b.nodeName]=!0,b=b.parentNode;return c}function o(a,b){for(;b.parentNode;){if(b===a)return!0;if(b.parentNode===a)return!0;b=b.parentNode}}function p(a,b){return!!a[b]}function q(a){var b=a.getSelection();if(b){var c=(b.getRangeAt(0),b.focusNode.parentNode);return c}}function r(){var a=q(this);return a?s(a):void 0}function s(b){var c,d=b.classList.contains(F);return c=d?b.style:a.getComputedStyle(b),parseInt(c.fontSize.replace(/px/i,""),10)}function t(){var a=q(this);return a?u(a):void 0}function u(a){var b=a.classList.contains(H),c=a.classList.contains(G);return c&&!b?parseInt(a.style.lineHeight.replace(/px/i,""),10):"auto"}function v(a){function c(a){var b,c,d=a.childNodes;for(c=0;c<d.length;c++)b=d[c],"#text"!==b.nodeName||b.textContent.length||a.removeChild(b)}function d(a){var c=Array.prototype.slice.call(a);c.forEach(function(a){var c,g;"#text"===a.nodeName?(c=e(a),c?f(a.parentNode):a.textContent.length&&(g=b.createElement("span"),a.parentNode.replaceChild(g,a),g.appendChild(a),f(g,a.parentNode))):d(a.childNodes),n||(n=g||a),o=g||a})}function e(a){var b=a.parentNode,c=Array.prototype.slice.call(b.childNodes),d=b.classList.contains(E)&&c.every(function(b){return b===a||"#text"===b.nodeName&&!b.textContent.length});return d}function f(b,c){var d=a.fontSize;if(void 0===d&&(d=s(b)),a.fontSizeOffset&&(d+=s(c||b)),b.classList.add(F,E),b.style.fontSize=d+"px",g.options.pickyHeight===!0){var e=a.lineHeight;void 0!==e&&"auto"!==e?b.classList.remove(H):("auto"!==e&&b.style.lineHeight||b.classList.add(H),b.classList.contains(H)&&(e=d*I)),void 0!==e&&(b.classList.add(G,E),b.style.lineHeight=e+"px")}}var g=this,h=g.getSelection();if(h){var i=h.getRangeAt(0),j=i.extractContents(),k=Array.prototype.slice.call(j.childNodes);if(0!==k.length){var l,m;for(m=k.length-1;m>=0;m--)l=k[m],i.insertNode(l);var n,o;c(l.parentNode),d(k),i.setStart(n),i.setEnd(o,"#text"===o.nodeName?o.textContent.length:o.childNodes.length),h.removeAllRanges(),h.addRange(i)}}}function w(a,b){return function(c,d){var e=this;e.restoreSelection(!d),e["exec"+a].apply(e,c||[]),e["report"+(b||a)]()}}function x(a,b,c){var d=/^['"]|['"]$/g,e=J[a]||B;return function(){var f=this,g=e.call(f,a),h="report."+b;return"bool"===c?g="true"===g||g===!0:"int"===c?g=parseInt(g,10):"fontName"===a&&(g=g.replace(d,"")),f.emit(h,g,b),g}}function y(a,b){var c,d=this;if("active"===b&&a===!1)for(c in d.state)delete d.state[b];d.state[b]=a}var z,A=[],B=b.queryCommandValue.bind(b),C=b.execCommand.bind(b),D="addEventListener";e.prototype=Object.create(c.prototype),e.prototype.constructor=e,e.prototype.focus=function(){var c=b.createRange(),d=a.getSelection();c.setStart(this.content,0),d.removeAllRanges(),d.addRange(c)},e.prototype.html=function(a){function b(a){return c.options.htmlWrap===!1?a:("<div>"!==a.substr(0,5)&&(a="<div>"+a+"</div>"),a)}var c=this;return void 0===a?b(c.content.innerHTML):(c.content.innerHTML=b(a),void 0)},e.prototype.getSelection=function(){var b,c=this,d=a.getSelection();return d.getRangeAt&&d.rangeCount&&(b=d.getRangeAt(0),o(c.content,b.commonAncestorContainer))?d:void 0},e.prototype.getRange=function(){var a=this,b=a.getSelection();return b?b.getRangeAt(0):void 0},e.prototype.saveSelection=function(){var a=this,b=a.getRange();void 0!==b&&(a.lastRange=b)},e.prototype.restoreSelection=function(b){var c,d=this,e=d.lastRange;e&&(c=a.getSelection(),c.removeAllRanges(),c.addRange(e),b===!0&&(d.lastRange=null))};var E="py-picky-element",F="py-picky-size",G="py-picky-height",H="py-picky-height-auto",I=1.5;e.prototype.execBold=function(){C("bold",!1)},e.prototype.execItalic=function(){C("italic",!1)},e.prototype.execSize=function(a){this.options.pixels?v.call(this,{fontSize:a}):C("fontSize",!1,a)},e.prototype.execHeight=function(a){this.options.pixels&&this.options.pickyHeight&&v.call(this,{lineHeight:a})},e.prototype.execSizeDecrease=function(){var a;this.options.pixels?v.call(this,{fontSize:-1,fontSizeOffset:!0}):(a=J.fontSize.call(this)-1,C("fontSize",!1,a))},e.prototype.execSizeIncrease=function(){var a;this.options.pixels?v.call(this,{fontSize:1,fontSizeOffset:!0}):(a=J.fontSize.call(this)+1,C("fontSize",!1,a))},e.prototype.execType=function(a){C("fontName",!1,a)},e.prototype.execColor=function(a){C("foreColor",!1,a)},e.prototype.execAlignment=function(a){var b=a[0].toUpperCase()+a.slice(1).toLowerCase();C("justify"+b,!1,null)},e.prototype.setBold=w("Bold"),e.prototype.setItalic=w("Italic"),e.prototype.setSize=w("Size"),e.prototype.decreaseSize=w("SizeDecrease","Size"),e.prototype.increaseSize=w("SizeIncrease","Size"),e.prototype.setType=w("Type"),e.prototype.setColor=w("Color"),e.prototype.setAlignment=w("Alignment"),e.prototype.setHeight=w("Height");var J={fontSize:function(){var a=this.options.pixels?r.call(this):B("fontSize");return parseInt(a,10)},lineHeight:function(){var a=this.options.pickyHeight?t.call(this):0;return a},alignment:function(){var a=B("justifyLeft"),b=B("justifyCenter"),c=B("justifyRight");return"true"===a||a===!0?"left":"true"===b||b===!0?"center":"true"===c||c===!0?"right":""}};e.prototype.reportBold=x("bold","bold","bool"),e.prototype.reportItalic=x("italic","italic","bool"),e.prototype.reportSize=x("fontSize","size","int"),e.prototype.reportType=x("fontName","type"),e.prototype.reportColor=x("foreColor","color"),e.prototype.reportAlignment=x("alignment","alignment"),e.prototype.reportAlignment=x("lineHeight","height"),e.prototype.report=function(){var a=this;a.reportBold(),a.reportItalic(),a.reportSize(),a.reportType(),a.reportColor(),a.reportAlignment()},e.prototype.meta={fontSizes:[1,2,3,4,5,6,7],fontPixels:[8,10,12,14,16,18,20,24,28,32,36,40,48,72],fontTypes:["Arial","Arial Black","Comic Sans MS","Courier","Courier New","Georgia","Helvetica","Impact","Palatino","Times New Roman","Trebuchet MS","Verdana"],alignments:["Left","Center","Right"],lineHeights:["auto",.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.8,2.1,2.5,3]},Object.freeze(e.prototype.meta),a.ponyedit=function(a){return a instanceof e?a:d(a)},a.ponyedit.meta=e.prototype.meta,a.ponyedit.init=function(a,b){var c=d(a);return c?c:new e(a,b)}}(window,document,EventEmitter2);