!function(a,b,c){"use strict";function d(a){for(var b,c=0,d=t.length;d>c;c++)if(b=t[c],b.element===a)return b.editor}function e(a,b){var d=this;c.call(d,{wildcard:!0}),d.content=a,d.options=b||{},f.call(d),g.call(d),k.call(d),t.push({editor:d,element:a})}function f(){var a=this,b=a.content;b.contentEditable=!0,b.classList.add("py-editable")}function g(){var a=this,c=b.createElement("textarea");c.className="py-pastebin",a.pastebin=c,b.body.appendChild(c),b[w]("paste",h.bind(a)),b[w]("keydown",i.bind(a)),b[w]("keypress",function(a){(a.metaKey&&!a.ctrlKey||a.ctrlKey&&!a.metaKey)&&118===a.keyCode&&h(a)})}function h(a){var b=this;n(b.content,a.target)&&(b.saveSelection(),pastebin.focus(),setTimeout(function(){b.restoreSelection(!0),j(pastebin.value),pastebin.value=""}))}function i(a){var b=this;n(b.content,a.target)&&9===a.keyCode&&(a.preventDefault(),v("insertHTML",!1,"    "))}function j(c){var d,e,f=a.getSelection();f.getRangeAt&&f.rangeCount&&(d=f.getRangeAt(0),d.deleteContents(),e=b.createTextNode(c),d.insertNode(e),f.removeAllRanges(),d=d.cloneRange(),d.selectNode(e),d.collapse(!1),f.addRange(d))}function k(){var a=this;b[w]("keyup",function(b){l.call(a,b)}),b[w]("mousedown",function(b){l.call(a,b)}),b[w]("mouseup",function(b){setTimeout(function(){l.call(a,b)})})}function l(b){var c=this;if(!n(c.popover,b.target)&&!n(c.pickerContainer,b.target)){var d=a.getSelection();c.saveSelection(),d.isCollapsed===!1&&(c.currentNodeList=m(c.content,d.focusNode),o(c.currentNodeList,"PONYEDIT")&&c.report()),s=d.isCollapsed,c.emit("report.active",!s)}}function m(a,b){for(var c={};b.parentNode;)b===a?c.PONYEDIT=!0:c[b.nodeName]=!0,b=b.parentNode;return c}function n(a,b){for(;b.parentNode;){if(b===a)return!0;if(b.parentNode===a)return!0;b=b.parentNode}}function o(a,b){return!!a[b]}function p(){return parseInt(u("fontSize"),10)}function q(a){return function(b,c){var d=this;d.restoreSelection(!c),d["exec"+a].apply(d,b||[]),d["report"+a]()}}function r(a,b,c){var d=/^['"]|['"]$/g;return function(){var e=this,f=u(a),g="report."+b;"bool"===c?f="true"===f||f===!0:"int"===c?f=parseInt(f,10):"fontName"===a&&(f=f.replace(d,"")),e.emit(g,f)}}var s,t=[],u=b.queryCommandValue.bind(b),v=b.execCommand.bind(b),w="addEventListener";e.prototype=Object.create(c.prototype),e.prototype.constructor=e,e.prototype.focus=function(){var c=b.createRange(),d=a.getSelection();c.setStart(this.content,0),d.removeAllRanges(),d.addRange(c)},e.prototype.html=function(a){function b(a){return c.options.htmlWrap===!1?a:("<div>"!==a.substr(0,5)&&(a="<div>"+a+"</div>"),a)}var c=this;return void 0===a?b(c.content.innerHTML):(c.content.innerHTML=b(a),void 0)},e.prototype.saveSelection=function(){var b,c=this,d=a.getSelection();d.getRangeAt&&d.rangeCount&&(b=d.getRangeAt(0),n(c.content,b.commonAncestorContainer)&&(c.lastRange=b))},e.prototype.restoreSelection=function(b){var c,d=this,e=d.lastRange;e&&(c=a.getSelection(),c.removeAllRanges(),c.addRange(e),b===!0&&(d.lastRange=null))},e.prototype.execBold=function(){v("bold",!1)},e.prototype.execItalic=function(){v("italic",!1)},e.prototype.execSize=function(a){v("fontSize",!1,a)},e.prototype.execSizeDecrease=function(){v("fontSize",!1,p()-1)},e.prototype.execSizeIncrease=function(){v("fontSize",!1,p()+1)},e.prototype.execType=function(a){v("fontName",!1,a)},e.prototype.execColor=function(a){v("foreColor",!1,a)},e.prototype.execAlignment=function(a){v("justify"+a,!1,null)},e.prototype.setBold=q("Bold"),e.prototype.setItalic=q("Italic"),e.prototype.setSize=q("Size"),e.prototype.setType=q("Type"),e.prototype.setColor=q("Color"),e.prototype.reportBold=r("bold","bold","bool"),e.prototype.reportItalic=r("italic","italic","bool"),e.prototype.reportSize=r("fontSize","size","int"),e.prototype.reportType=r("fontName","type"),e.prototype.reportColor=r("foreColor","color"),e.prototype.report=function(){var a=this;a.reportBold(),a.reportItalic(),a.reportSize(),a.reportType(),a.reportColor()},e.prototype.meta={fontSizes:[1,2,3,4,5,6,7],fontTypes:["Arial","Arial Black","Comic Sans MS","Courier","Courier New","Georgia","Helvetica","Impact","Palatino","Times New Roman","Trebuchet MS","Verdana"],alignments:["Left","Center","Right"]},Object.freeze(e.prototype.meta),a.ponyedit=function(a){return d(a)},a.ponyedit.meta=e.prototype.meta,a.ponyedit.init=function(a,b){if(a instanceof e)return a;var c=d(a);return c?c:new e(a,b)}}(window,document,EventEmitter2);